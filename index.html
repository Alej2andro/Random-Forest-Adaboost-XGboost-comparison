<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alejandro Figueroa Rojas">
<meta name="dcterms.date" content="2026-02-12">

<title>Proyecto: Ensamble de Algoritmos - Random Forest, AdaBoost y XGBoost</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Randomforest_adaboost_xgboost_files/libs/clipboard/clipboard.min.js"></script>
<script src="Randomforest_adaboost_xgboost_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Randomforest_adaboost_xgboost_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Randomforest_adaboost_xgboost_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Randomforest_adaboost_xgboost_files/libs/quarto-html/popper.min.js"></script>
<script src="Randomforest_adaboost_xgboost_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Randomforest_adaboost_xgboost_files/libs/quarto-html/anchor.min.js"></script>
<link href="Randomforest_adaboost_xgboost_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Randomforest_adaboost_xgboost_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Randomforest_adaboost_xgboost_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Randomforest_adaboost_xgboost_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Randomforest_adaboost_xgboost_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenido</h2>
   
  <ul>
  <li><a href="#motivación-y-contexto" id="toc-motivación-y-contexto" class="nav-link active" data-scroll-target="#motivación-y-contexto"><span class="header-section-number">1</span> Motivación y Contexto</a></li>
  <li><a href="#carga-de-bibliotecas-y-datos" id="toc-carga-de-bibliotecas-y-datos" class="nav-link" data-scroll-target="#carga-de-bibliotecas-y-datos"><span class="header-section-number">2</span> Carga de Bibliotecas y Datos</a></li>
  <li><a href="#exploración-de-datos" id="toc-exploración-de-datos" class="nav-link" data-scroll-target="#exploración-de-datos"><span class="header-section-number">3</span> Exploración de Datos</a></li>
  <li><a href="#preprocesamiento" id="toc-preprocesamiento" class="nav-link" data-scroll-target="#preprocesamiento"><span class="header-section-number">4</span> Preprocesamiento</a>
  <ul>
  <li><a href="#limpieza-y-transformación" id="toc-limpieza-y-transformación" class="nav-link" data-scroll-target="#limpieza-y-transformación"><span class="header-section-number">4.1</span> Limpieza y Transformación</a></li>
  <li><a href="#visualización-del-desbalanceo" id="toc-visualización-del-desbalanceo" class="nav-link" data-scroll-target="#visualización-del-desbalanceo"><span class="header-section-number">4.2</span> Visualización del Desbalanceo</a></li>
  <li><a href="#división-estratificada" id="toc-división-estratificada" class="nav-link" data-scroll-target="#división-estratificada"><span class="header-section-number">4.3</span> División Estratificada</a></li>
  </ul></li>
  <li><a href="#fundamentos-teóricos-de-los-algoritmos" id="toc-fundamentos-teóricos-de-los-algoritmos" class="nav-link" data-scroll-target="#fundamentos-teóricos-de-los-algoritmos"><span class="header-section-number">5</span> Fundamentos Teóricos de los Algoritmos</a>
  <ul>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">5.1</span> Random Forest</a>
  <ul class="collapse">
  <li><a href="#definición-matemática" id="toc-definición-matemática" class="nav-link" data-scroll-target="#definición-matemática"><span class="header-section-number">5.1.1</span> Definición Matemática</a></li>
  </ul></li>
  <li><a href="#adaboost" id="toc-adaboost" class="nav-link" data-scroll-target="#adaboost"><span class="header-section-number">5.2</span> AdaBoost</a>
  <ul class="collapse">
  <li><a href="#definición-matemática-1" id="toc-definición-matemática-1" class="nav-link" data-scroll-target="#definición-matemática-1"><span class="header-section-number">5.2.1</span> Definición Matemática</a></li>
  </ul></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="header-section-number">5.3</span> XGBoost</a>
  <ul class="collapse">
  <li><a href="#definición-matemática-2" id="toc-definición-matemática-2" class="nav-link" data-scroll-target="#definición-matemática-2"><span class="header-section-number">5.3.1</span> Definición Matemática</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#random-forest-con-class-weights" id="toc-random-forest-con-class-weights" class="nav-link" data-scroll-target="#random-forest-con-class-weights"><span class="header-section-number">6</span> Random Forest con Class Weights</a>
  <ul>
  <li><a href="#visualización-matriz-de-confusión-random-forest" id="toc-visualización-matriz-de-confusión-random-forest" class="nav-link" data-scroll-target="#visualización-matriz-de-confusión-random-forest"><span class="header-section-number">6.1</span> Visualización Matriz de Confusión Random Forest</a></li>
  <li><a href="#métricas-random-forest" id="toc-métricas-random-forest" class="nav-link" data-scroll-target="#métricas-random-forest"><span class="header-section-number">6.2</span> Métricas Random Forest</a></li>
  <li><a href="#importancia-de-variables-rf" id="toc-importancia-de-variables-rf" class="nav-link" data-scroll-target="#importancia-de-variables-rf"><span class="header-section-number">6.3</span> Importancia de Variables RF</a></li>
  <li><a href="#real-vs-predicción-rf" id="toc-real-vs-predicción-rf" class="nav-link" data-scroll-target="#real-vs-predicción-rf"><span class="header-section-number">6.4</span> Real vs Predicción RF</a></li>
  <li><a href="#frontera-de-decisión-rf" id="toc-frontera-de-decisión-rf" class="nav-link" data-scroll-target="#frontera-de-decisión-rf"><span class="header-section-number">6.5</span> Frontera de Decisión RF</a></li>
  </ul></li>
  <li><a href="#algortimo-adaboost" id="toc-algortimo-adaboost" class="nav-link" data-scroll-target="#algortimo-adaboost"><span class="header-section-number">7</span> Algortimo AdaBoost</a>
  <ul>
  <li><a href="#matriz-de-confusión-adaboost" id="toc-matriz-de-confusión-adaboost" class="nav-link" data-scroll-target="#matriz-de-confusión-adaboost"><span class="header-section-number">7.1</span> Matriz de Confusión AdaBoost</a></li>
  <li><a href="#métricas-adaboost" id="toc-métricas-adaboost" class="nav-link" data-scroll-target="#métricas-adaboost"><span class="header-section-number">7.2</span> Métricas AdaBoost</a></li>
  <li><a href="#importancia-de-variables-adaboost" id="toc-importancia-de-variables-adaboost" class="nav-link" data-scroll-target="#importancia-de-variables-adaboost"><span class="header-section-number">7.3</span> Importancia de Variables AdaBoost</a></li>
  <li><a href="#real-vs-predicción-adaboost" id="toc-real-vs-predicción-adaboost" class="nav-link" data-scroll-target="#real-vs-predicción-adaboost"><span class="header-section-number">7.4</span> Real vs Predicción AdaBoost</a></li>
  <li><a href="#frontera-de-decisión-adaboost" id="toc-frontera-de-decisión-adaboost" class="nav-link" data-scroll-target="#frontera-de-decisión-adaboost"><span class="header-section-number">7.5</span> Frontera de Decisión AdaBoost</a></li>
  </ul></li>
  <li><a href="#xgboost-con-scale_pos_weight" id="toc-xgboost-con-scale_pos_weight" class="nav-link" data-scroll-target="#xgboost-con-scale_pos_weight"><span class="header-section-number">8</span> XGBoost con Scale_pos_weight</a>
  <ul>
  <li><a href="#matriz-de-confusión-xgboost" id="toc-matriz-de-confusión-xgboost" class="nav-link" data-scroll-target="#matriz-de-confusión-xgboost"><span class="header-section-number">8.1</span> Matriz de Confusión XGBoost</a></li>
  <li><a href="#métricas-xgboost" id="toc-métricas-xgboost" class="nav-link" data-scroll-target="#métricas-xgboost"><span class="header-section-number">8.2</span> Métricas XGBoost</a></li>
  <li><a href="#importancia-de-variables-xgboost" id="toc-importancia-de-variables-xgboost" class="nav-link" data-scroll-target="#importancia-de-variables-xgboost"><span class="header-section-number">8.3</span> Importancia de Variables XGBoost</a></li>
  <li><a href="#real-vs-predicción-xgboost" id="toc-real-vs-predicción-xgboost" class="nav-link" data-scroll-target="#real-vs-predicción-xgboost"><span class="header-section-number">8.4</span> Real vs Predicción XGBoost</a></li>
  <li><a href="#frontera-de-decisión-xgboost" id="toc-frontera-de-decisión-xgboost" class="nav-link" data-scroll-target="#frontera-de-decisión-xgboost"><span class="header-section-number">8.5</span> Frontera de Decisión XGBoost</a></li>
  </ul></li>
  <li><a href="#comparación-de-modelos" id="toc-comparación-de-modelos" class="nav-link" data-scroll-target="#comparación-de-modelos"><span class="header-section-number">9</span> Comparación de Modelos</a>
  <ul>
  <li><a href="#visualización-comparativa" id="toc-visualización-comparativa" class="nav-link" data-scroll-target="#visualización-comparativa"><span class="header-section-number">9.1</span> Visualización Comparativa</a></li>
  <li><a href="#curvas-de-trayectoria-predicciones-vs-real-test" id="toc-curvas-de-trayectoria-predicciones-vs-real-test" class="nav-link" data-scroll-target="#curvas-de-trayectoria-predicciones-vs-real-test"><span class="header-section-number">9.2</span> Curvas de Trayectoria: Predicciones vs Real (Test)</a></li>
  </ul></li>
  <li><a href="#curvas-roc-y-precision-recall" id="toc-curvas-roc-y-precision-recall" class="nav-link" data-scroll-target="#curvas-roc-y-precision-recall"><span class="header-section-number">10</span> Curvas ROC y Precision-Recall</a></li>
  <li><a href="#evaluación-con-datos-nuevos" id="toc-evaluación-con-datos-nuevos" class="nav-link" data-scroll-target="#evaluación-con-datos-nuevos"><span class="header-section-number">11</span> Evaluación con Datos Nuevos</a>
  <ul>
  <li><a href="#predicciones-en-datos-nuevos" id="toc-predicciones-en-datos-nuevos" class="nav-link" data-scroll-target="#predicciones-en-datos-nuevos"><span class="header-section-number">11.1</span> Predicciones en Datos Nuevos</a></li>
  <li><a href="#métricas-con-datos-nuevos" id="toc-métricas-con-datos-nuevos" class="nav-link" data-scroll-target="#métricas-con-datos-nuevos"><span class="header-section-number">11.2</span> Métricas con Datos Nuevos</a></li>
  <li><a href="#comparación-test-vs-nuevos-datos" id="toc-comparación-test-vs-nuevos-datos" class="nav-link" data-scroll-target="#comparación-test-vs-nuevos-datos"><span class="header-section-number">11.3</span> Comparación Test vs Nuevos Datos</a></li>
  </ul></li>
  <li><a href="#conclusiones-y-recomendaciones" id="toc-conclusiones-y-recomendaciones" class="nav-link" data-scroll-target="#conclusiones-y-recomendaciones"><span class="header-section-number">12</span> Conclusiones y Recomendaciones</a>
  <ul>
  <li><a href="#rendimiento-comparativo" id="toc-rendimiento-comparativo" class="nav-link" data-scroll-target="#rendimiento-comparativo"><span class="header-section-number">12.1</span> Rendimiento Comparativo</a></li>
  <li><a href="#análisis-por-algoritmo" id="toc-análisis-por-algoritmo" class="nav-link" data-scroll-target="#análisis-por-algoritmo"><span class="header-section-number">12.2</span> Análisis por Algoritmo</a></li>
  <li><a href="#variables-clave-identificadas" id="toc-variables-clave-identificadas" class="nav-link" data-scroll-target="#variables-clave-identificadas"><span class="header-section-number">12.3</span> Variables Clave Identificadas</a></li>
  <li><a href="#recomendaciones-por-contexto-clínico" id="toc-recomendaciones-por-contexto-clínico" class="nav-link" data-scroll-target="#recomendaciones-por-contexto-clínico"><span class="header-section-number">12.4</span> Recomendaciones por Contexto Clínico</a></li>
  <li><a href="#conclusión-general" id="toc-conclusión-general" class="nav-link" data-scroll-target="#conclusión-general"><span class="header-section-number">12.5</span> Conclusión General</a></li>
  </ul></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias"><span class="header-section-number">13</span> Referencias</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Proyecto: Ensamble de Algoritmos - Random Forest, AdaBoost y XGBoost</h1>
<p class="subtitle lead">Detección de Cáncer de Mama - Análisis Comparativo con Desbalanceo Moderado</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alejandro Figueroa Rojas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="motivación-y-contexto" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Motivación y Contexto</h1>
<p>Este proyecto aplica algoritmos de ensamble al dataset BreastCancer para <strong>explorar cómo diferentes técnicas manejan desbalanceo de clases</strong> y <strong>comprender las matemáticas detrás de cada método</strong>.</p>
<p><strong>Desafío del dataset:</strong></p>
<ul>
<li>Desbalanceo moderado (35% malignos, 65% benignos)</li>
<li>Variables ordinales (escala 1-10) con valores faltantes</li>
<li>Trade-off crítico: detectar malignos vs evitar falsos positivos</li>
</ul>
<p><strong>Objetivo de aprendizaje:</strong></p>
<p>Implementar y comparar tres ensambles (Random Forest, AdaBoost, XGBoost) para entender:</p>
<ul>
<li>Cómo Bagging reduce varianza mediante aleatorización</li>
<li>Cómo Boosting corrige errores secuencialmente con pesos adaptativos</li>
<li>Cómo la regularización en XGBoost previene overfitting</li>
</ul>
<p><strong>Contexto clínico:</strong></p>
<p>Un cáncer no detectado (FN) es crítico para el paciente. Falsos positivos (FP) generan biopsias innecesarias pero son menos graves. Los modelos deben priorizar Sensitivity.</p>
</section>
<section id="carga-de-bibliotecas-y-datos" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Carga de Bibliotecas y Datos</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlbench)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PRROC)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adabag)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BreastCancer)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> BreastCancer</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="exploración-de-datos" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Exploración de Datos</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">str</span>(datos)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datos)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   699 obs. of  11 variables:
 $ Id             : chr  "1000025" "1002945" "1015425" "1016277" ...
 $ Cl.thickness   : Ord.factor w/ 10 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 5 5 3 6 4 8 1 2 2 4 ...
 $ Cell.size      : Ord.factor w/ 10 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 1 4 1 8 1 10 1 1 1 2 ...
 $ Cell.shape     : Ord.factor w/ 10 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 1 4 1 8 1 10 1 2 1 1 ...
 $ Marg.adhesion  : Ord.factor w/ 10 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 1 5 1 1 3 8 1 1 1 1 ...
 $ Epith.c.size   : Ord.factor w/ 10 levels "1"&lt;"2"&lt;"3"&lt;"4"&lt;..: 2 7 2 3 2 7 2 2 2 2 ...
 $ Bare.nuclei    : Factor w/ 10 levels "1","2","3","4",..: 1 10 2 4 1 10 10 1 1 1 ...
 $ Bl.cromatin    : Factor w/ 10 levels "1","2","3","4",..: 3 3 3 3 3 9 3 3 1 2 ...
 $ Normal.nucleoli: Factor w/ 10 levels "1","2","3","4",..: 1 2 1 7 1 7 1 1 1 1 ...
 $ Mitoses        : Factor w/ 9 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 5 1 ...
 $ Class          : Factor w/ 2 levels "benign","malignant": 1 1 1 1 1 2 1 1 1 1 ...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 699  11</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== ESTADÍSTICAS BÁSICAS ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total casos:"</span>, <span class="fu">nrow</span>(datos), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Features:"</span>, <span class="fu">ncol</span>(datos)<span class="sc">-</span><span class="dv">2</span>, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== ESTADÍSTICAS BÁSICAS ===
Total casos: 699 
Features: 9 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== DISTRIBUCIÓN CLASE ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DISTRIBUCIÓN CLASE ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(datos<span class="sc">$</span>Class))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   benign malignant 
      458       241 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Proporción malignos:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(datos<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Proporción malignos: 34.48 %</code></pre>
</div>
</div>
<p><strong>Variables predictoras (9 características citológicas, escala 1-10):</strong></p>
<ul>
<li><strong>Cl.thickness:</strong> Grosor del grupo celular</li>
<li><strong>Cell.size:</strong> Uniformidad del tamaño celular</li>
<li><strong>Cell.shape:</strong> Uniformidad de la forma celular</li>
<li><strong>Marg.adhesion:</strong> Adhesión marginal</li>
<li><strong>Epith.c.size:</strong> Tamaño de células epiteliales</li>
<li><strong>Bare.nuclei:</strong> Núcleos desnudos</li>
<li><strong>Bl.cromatin:</strong> Cromatina suave</li>
<li><strong>Normal.nucleoli:</strong> Nucléolos normales</li>
<li><strong>Mitoses:</strong> Actividad mitótica</li>
</ul>
<p><strong>Variable objetivo:</strong> Class (benign/malignant)</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== VALORES FALTANTES ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sapply</span>(datos, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))))}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== VALORES FALTANTES ===
             Id    Cl.thickness       Cell.size      Cell.shape   Marg.adhesion 
              0               0               0               0               0 
   Epith.c.size     Bare.nuclei     Bl.cromatin Normal.nucleoli         Mitoses 
              0              16               0               0               0 
          Class 
              0 </code></pre>
</div>
</div>
</section>
<section id="preprocesamiento" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Preprocesamiento</h1>
<section id="limpieza-y-transformación" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="limpieza-y-transformación"><span class="header-section-number">4.1</span> Limpieza y Transformación</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Id <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(col <span class="cf">in</span> <span class="fu">names</span>(datos)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  datos[[col]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(datos[[col]]))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Bare.nuclei[<span class="fu">is.na</span>(datos<span class="sc">$</span>Bare.nuclei)] <span class="ot">&lt;-</span> <span class="fu">median</span>(datos<span class="sc">$</span>Bare.nuclei, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NAs restantes:"</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(datos)), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>NAs restantes: 0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Cl.thickness      Cell.size        Cell.shape     Marg.adhesion   
 Min.   : 1.000   Min.   : 1.000   Min.   : 1.000   Min.   : 1.000  
 1st Qu.: 2.000   1st Qu.: 1.000   1st Qu.: 1.000   1st Qu.: 1.000  
 Median : 4.000   Median : 1.000   Median : 1.000   Median : 1.000  
 Mean   : 4.418   Mean   : 3.134   Mean   : 3.207   Mean   : 2.807  
 3rd Qu.: 6.000   3rd Qu.: 5.000   3rd Qu.: 5.000   3rd Qu.: 4.000  
 Max.   :10.000   Max.   :10.000   Max.   :10.000   Max.   :10.000  
  Epith.c.size     Bare.nuclei      Bl.cromatin     Normal.nucleoli 
 Min.   : 1.000   Min.   : 1.000   Min.   : 1.000   Min.   : 1.000  
 1st Qu.: 2.000   1st Qu.: 1.000   1st Qu.: 2.000   1st Qu.: 1.000  
 Median : 2.000   Median : 1.000   Median : 3.000   Median : 1.000  
 Mean   : 3.216   Mean   : 3.486   Mean   : 3.438   Mean   : 2.867  
 3rd Qu.: 4.000   3rd Qu.: 5.000   3rd Qu.: 5.000   3rd Qu.: 4.000  
 Max.   :10.000   Max.   :10.000   Max.   :10.000   Max.   :10.000  
    Mitoses             Class    
 Min.   : 1.000   benign   :458  
 1st Qu.: 1.000   malignant:241  
 Median : 1.000                  
 Mean   : 1.589                  
 3rd Qu.: 1.000                  
 Max.   :10.000                  </code></pre>
</div>
</div>
</section>
<section id="visualización-del-desbalanceo" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="visualización-del-desbalanceo"><span class="header-section-number">4.2</span> Visualización del Desbalanceo</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x=</span>Class, <span class="at">fill=</span>Class)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat=</span><span class="st">'count'</span>, <span class="fu">aes</span>(<span class="at">label=</span>..count..), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Distribución de Clases"</span>, <span class="at">x=</span><span class="st">"Diagnóstico"</span>, <span class="at">y=</span><span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x=</span>Class, <span class="at">y=</span>Cl.thickness, <span class="at">fill=</span>Class)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Grosor Celular por Clase"</span>, <span class="at">y=</span><span class="st">"Cl.thickness"</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x=</span>Class, <span class="at">y=</span>Cell.size, <span class="at">fill=</span>Class)) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Tamaño Celular por Clase"</span>, <span class="at">y=</span><span class="st">"Cell.size"</span>) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/desbalanceo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p><strong>Análisis de Distribución y Características Celulares por Clase</strong></p>
<p><strong>Distribución de Clases:</strong></p>
<p>El dataset presenta un desbalance significativo, con aproximadamente 65% de casos benignos (458) y 35% malignos (241), no una distribución 50-50 como menciona.</p>
<p><strong>Grosor Celular por Clase:</strong></p>
<p>Los tumores malignos muestran grosor celular considerablemente mayor que los benignos. La mediana de casos malignos se sitúa cerca de 8, mientras que los benignos presentan mediana aproximada de 3. El rango intercuartílico de malignos abarca prácticamente todo el espectro de valores (5-10), contrastando con el rango reducido de benignos (1-4).</p>
<p><strong>Tamaño Celular por Clase:</strong></p>
<p>Los tumores benignos exhiben múltiples outliers en valores altos, indicando casos atípicos con células grandes. Los malignos presentan mediana superior a 5 y un boxplot de mayor magnitud, con rango intercuartílico amplio (5-10) comparado con benignos (aproximadamente 1-3). Esta diferencia sugiere que el tamaño celular es un discriminador efectivo entre ambas clases.</p>
</section>
<section id="división-estratificada" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="división-estratificada"><span class="header-section-number">4.3</span> División Estratificada</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Class, <span class="at">p=</span><span class="fl">0.7</span>, <span class="at">list=</span><span class="cn">FALSE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[trainIndex,]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>trainIndex,]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== CONJUNTO TRAIN ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total:"</span>, <span class="fu">nrow</span>(train), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(train<span class="sc">$</span>Class))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"% Malignos:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(train<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== CONJUNTO TRAIN ===
Total: 490 

   benign malignant 
      321       169 
% Malignos: 34.49 %</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== CONJUNTO TEST ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total:"</span>, <span class="fu">nrow</span>(test), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(test<span class="sc">$</span>Class))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"% Malignos:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== CONJUNTO TEST ===
Total: 209 

   benign malignant 
      137        72 
% Malignos: 34.45 %</code></pre>
</div>
</div>
</section>
</section>
<section id="fundamentos-teóricos-de-los-algoritmos" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Fundamentos Teóricos de los Algoritmos</h1>
<section id="random-forest" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">5.1</span> Random Forest</h2>
<section id="definición-matemática" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="definición-matemática"><span class="header-section-number">5.1.1</span> Definición Matemática</h3>
<p><strong>Random Forest</strong> es un método de ensamble basado en <strong>Bagging</strong> (Bootstrap Aggregation) que construye múltiples árboles de decisión y combina sus predicciones.</p>
<p><strong>Algoritmo para Clasificación:</strong></p>
<p>Para cada árbol <span class="math inline">\(b = 1, \ldots, B\)</span>:</p>
<ol type="1">
<li>Extraer muestra bootstrap de tamaño <span class="math inline">\(N\)</span> del conjunto de entrenamiento</li>
<li>Construir árbol de decisión:
<ul>
<li>En cada nodo interno, seleccionar aleatoriamente <span class="math inline">\(m\)</span> variables de las <span class="math inline">\(p\)</span> disponibles</li>
<li>Elegir la mejor variable/punto de corte solo entre estas <span class="math inline">\(m\)</span> variables</li>
<li>Dividir el nodo usando esta variable</li>
<li>Crecer árbol hasta profundidad máxima (sin poda)</li>
</ul></li>
</ol>
<p><strong>Predicción:</strong></p>
<p><span class="math display">\[\hat{C}^B_{rf}(x) = \text{majority vote}\{\hat{C}_b(x)\}_{b=1}^B\]</span></p>
<p><strong>Hiperparámetro <span class="math inline">\(m\)</span> (valores por defecto):</strong></p>
<ul>
<li>Clasificación: <span class="math inline">\(m = \lfloor\sqrt{p}\rfloor\)</span></li>
<li>Regresión: <span class="math inline">\(m = \lfloor p/3 \rfloor\)</span></li>
</ul>
<p><strong>Reducción de Varianza:</strong></p>
<p>La varianza del promedio de <span class="math inline">\(B\)</span> árboles con varianza <span class="math inline">\(\sigma^2\)</span> y correlación <span class="math inline">\(\rho\)</span>:</p>
<p><span class="math display">\[\text{Var}\left(\frac{1}{B}\sum_{b=1}^B T_b\right) = \rho\sigma^2 + \frac{1-\rho}{B}\sigma^2\]</span></p>
<p>Al limitar a <span class="math inline">\(m &lt; p\)</span> variables, se reduce <span class="math inline">\(\rho\)</span>, logrando:</p>
<p><span class="math display">\[\text{Var}(\hat{f}_{rf}) &lt; \text{Var}(\hat{f}_{bag})\]</span></p>
</section>
</section>
<section id="adaboost" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="adaboost"><span class="header-section-number">5.2</span> AdaBoost</h2>
<section id="definición-matemática-1" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="definición-matemática-1"><span class="header-section-number">5.2.1</span> Definición Matemática</h3>
<p><strong>AdaBoost</strong> (Adaptive Boosting) es un método de <strong>Boosting</strong> que combina clasificadores débiles secuencialmente, ajustando los pesos de observaciones mal clasificadas.</p>
<p><strong>Algoritmo AdaBoost.M1:</strong></p>
<p><strong>Inicialización:</strong> <span class="math inline">\(w_i = \frac{1}{N}\)</span>, <span class="math inline">\(i = 1, \ldots, N\)</span></p>
<p>Para <span class="math inline">\(m = 1\)</span> hasta <span class="math inline">\(M\)</span>:</p>
<ol type="1">
<li><p>Ajustar clasificador <span class="math inline">\(G_m(x)\)</span> a los datos con pesos <span class="math inline">\(w_i\)</span></p></li>
<li><p>Calcular error ponderado:</p></li>
</ol>
<p><span class="math display">\[\text{err}_m = \frac{\sum_{i=1}^N w_i \mathbb{I}(y_i \neq G_m(x_i))}{\sum_{i=1}^N w_i}\]</span></p>
<p>donde:</p>
<ul>
<li><span class="math inline">\(\text{err}_m\)</span>: tasa de error ponderada del clasificador <span class="math inline">\(m\)</span></li>
<li><span class="math inline">\(w_i\)</span>: peso de la observación <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(y_i\)</span>: etiqueta verdadera</li>
<li><span class="math inline">\(G_m(x_i)\)</span>: predicción del clasificador <span class="math inline">\(m\)</span></li>
<li><span class="math inline">\(\mathbb{I}(\cdot)\)</span>: función indicadora (1 si hay error, 0 si no)</li>
</ul>
<ol start="3" type="1">
<li><p>Calcular coeficiente del clasificador: <span class="math display">\[\alpha_m = \log\left(\frac{1 - \text{err}_m}{\text{err}_m}\right)\]</span></p></li>
<li><p>Actualizar pesos: <span class="math display">\[w_i \leftarrow w_i \cdot \exp[\alpha_m \cdot \mathbb{I}(y_i \neq G_m(x_i))]\]</span></p></li>
<li><p>Renormalizar: <span class="math inline">\(w_i \leftarrow \frac{w_i}{\sum_{j=1}^N w_j}\)</span></p></li>
</ol>
<p><strong>Predicción final:</strong></p>
<p><span class="math display">\[G(x) = \text{sign}\left[\sum_{m=1}^M \alpha_m G_m(x)\right]\]</span></p>
<p><strong>Función de Pérdida Exponencial:</strong></p>
<p>AdaBoost minimiza:</p>
<p><span class="math display">\[L(y, f(x)) = \exp(-yf(x))\]</span></p>
<p>donde <span class="math inline">\(y \in \{-1, +1\}\)</span> y <span class="math inline">\(f(x) = \sum_{m=1}^M \alpha_m G_m(x)\)</span>.</p>
<p><strong>Minimizador poblacional:</strong></p>
<p><span class="math display">\[f^*(x) = \frac{1}{2}\log\frac{P(Y=1|x)}{P(Y=-1|x)}\]</span></p>
</section>
</section>
<section id="xgboost" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">5.3</span> XGBoost</h2>
<section id="definición-matemática-2" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="definición-matemática-2"><span class="header-section-number">5.3.1</span> Definición Matemática</h3>
<p><strong>XGBoost</strong> (Extreme Gradient Boosting) es una extensión de Gradient Boosting con regularización explícita.</p>
<p><strong>Algoritmo Gradient Boosting:</strong></p>
<p><strong>Inicialización:</strong> <span class="math display">\[f_0(x) = \arg\min_\gamma \sum_{i=1}^N L(y_i, \gamma)\]</span></p>
<p>Para <span class="math inline">\(m = 1\)</span> hasta <span class="math inline">\(M\)</span>:</p>
<ol type="1">
<li><p>Calcular pseudo-residuos (gradiente negativo): <span class="math display">\[r_{im} = -\left[\frac{\partial L(y_i, f(x_i))}{\partial f(x_i)}\right]_{f=f_{m-1}}\]</span></p></li>
<li><p>Ajustar árbol a <span class="math inline">\(\{(x_i, r_{im})\}_{i=1}^N\)</span>, obteniendo regiones <span class="math inline">\(R_{jm}\)</span></p></li>
<li><p>Optimizar coeficientes: <span class="math display">\[\gamma_{jm} = \arg\min_\gamma \sum_{x_i \in R_{jm}} L(y_i, f_{m-1}(x_i) + \gamma)\]</span></p></li>
<li><p>Actualizar: <span class="math display">\[f_m(x) = f_{m-1}(x) + \nu\sum_{j=1}^{J_m} \gamma_{jm}\mathbb{I}(x \in R_{jm})\]</span></p></li>
</ol>
<p><strong>XGBoost con Regularización:</strong></p>
<p>Función objetivo en iteración <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[\mathcal{L}^{(t)} = \sum_{i=1}^n l(y_i, \hat{y}_i^{(t-1)} + f_t(x_i)) + \Omega(f_t)\]</span></p>
<p><strong>Regularización:</strong></p>
<p><span class="math display">\[\Omega(f) = \gamma T + \frac{1}{2}\lambda\sum_{j=1}^T w_j^2\]</span></p>
<p><strong>Aproximación de segundo orden (Taylor):</strong></p>
<p><span class="math display">\[\mathcal{L}^{(t)} \approx \sum_{i=1}^n\left[g_i f_t(x_i) + \frac{1}{2}h_i f_t^2(x_i)\right] + \Omega(f_t)\]</span></p>
<p>donde:</p>
<ul>
<li><span class="math inline">\(g_i = \frac{\partial l(y_i, \hat{y}^{(t-1)})}{\partial \hat{y}^{(t-1)}}\)</span> (gradiente)</li>
<li><span class="math inline">\(h_i = \frac{\partial^2 l(y_i, \hat{y}^{(t-1)})}{\partial(\hat{y}^{(t-1)})^2}\)</span> (Hessiano)</li>
</ul>
<p><strong>Peso óptimo por hoja:</strong></p>
<p><span class="math display">\[w_j^* = -\frac{\sum_{i \in I_j} g_i}{\sum_{i \in I_j} h_i + \lambda}\]</span></p>
<p><strong>Ganancia al dividir:</strong></p>
<p><span class="math display">\[\text{Gain} = \frac{1}{2}\left[\frac{(\sum_{i \in I_L} g_i)^2}{\sum_{i \in I_L} h_i + \lambda} + \frac{(\sum_{i \in I_R} g_i)^2}{\sum_{i \in I_R} h_i + \lambda} - \frac{(\sum_{i \in I} g_i)^2}{\sum_{i \in I} h_i + \lambda}\right] - \gamma\]</span></p>
</section>
</section>
</section>
<section id="random-forest-con-class-weights" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Random Forest con Class Weights</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>n_benign <span class="ot">&lt;-</span> <span class="fu">sum</span>(train<span class="sc">$</span>Class <span class="sc">==</span> <span class="st">"benign"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>n_malignant <span class="ot">&lt;-</span> <span class="fu">sum</span>(train<span class="sc">$</span>Class <span class="sc">==</span> <span class="st">"malignant"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>weight_malignant <span class="ot">&lt;-</span> n_benign <span class="sc">/</span> n_malignant</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Class weight malignant:"</span>, <span class="fu">round</span>(weight_malignant, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Class weight malignant: 1.9 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  Class <span class="sc">~</span> .,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">500</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">3</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">classwt =</span> <span class="fu">c</span>(<span class="st">"benign"</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"malignant"</span><span class="ot">=</span>weight_malignant),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>rf_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test, <span class="at">type=</span><span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>rf_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_pred, test<span class="sc">$</span>Class, <span class="at">positive=</span><span class="st">"malignant"</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_cm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  benign malignant
  benign       132         4
  malignant      5        68
                                          
               Accuracy : 0.9569          
                 95% CI : (0.9198, 0.9801)
    No Information Rate : 0.6555          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.905           
                                          
 Mcnemar's Test P-Value : 1               
                                          
            Sensitivity : 0.9444          
            Specificity : 0.9635          
         Pos Pred Value : 0.9315          
         Neg Pred Value : 0.9706          
             Prevalence : 0.3445          
         Detection Rate : 0.3254          
   Detection Prevalence : 0.3493          
      Balanced Accuracy : 0.9540          
                                          
       'Positive' Class : malignant       
                                          </code></pre>
</div>
</div>
<p><strong>Interpretación de resultados</strong></p>
<p><strong>Class weight maligno: 1.9</strong></p>
<ul>
<li>Asigna mayor importancia a errores en casos malignos (clase minoritaria), compensando el desbalance de clases. Esto penaliza más los falsos negativos, priorizando la detección de tumores malignos sobre la precisión en benignos. El factor 1.9 aproximadamente duplica la influencia de cada muestra maligna durante el entrenamiento.</li>
</ul>
<p>Matriz de confusión:</p>
<ul>
<li>Verdaderos negativos (VN): 132 casos benignos correctamente clasificados</li>
<li>Verdaderos positivos (VP): 68 casos malignos correctamente clasificados<br>
</li>
<li>Falsos positivos (FP): 5 casos benignos clasificados erróneamente como malignos</li>
<li>Falsos negativos (FN): 4 casos malignos clasificados erróneamente como benignos</li>
</ul>
<p>Métricas de desempeño:</p>
<ul>
<li><strong>Accuracy: 0.9569</strong> - Alta proporción de predicciones correctas (VP + VN) / Total</li>
<li><strong>Sensitivity (Recall): 0.9444</strong> - El modelo detecta correctamente 94.4% de los casos malignos reales (VP / (VP + FN))</li>
<li><strong>Specificity: 0.9635</strong> - El modelo detecta correctamente 96.4% de los casos benignos reales (VN / (VN + FP))</li>
<li><strong>Balanced Accuracy: 0.9540</strong> - Promedio de sensitivity y specificity, útil con clases desbalanceadas</li>
<li><strong>Kappa: 0.905</strong> - Acuerdo muy alto entre predicciones y valores reales, ajustado por azar</li>
</ul>
<p>El modelo muestra excelente desempeño balanceado en ambas clases. Los 4 falsos negativos son más críticos clínicamente (malignos no detectados) que los 5 falsos positivos.</p>
<section id="visualización-matriz-de-confusión-random-forest" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="visualización-matriz-de-confusión-random-forest"><span class="header-section-number">6.1</span> Visualización Matriz de Confusión Random Forest</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer matriz de confusión</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>rf_table <span class="ot">&lt;-</span> <span class="fu">as.table</span>(rf_cm<span class="sc">$</span>table)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>rf_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(rf_table)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rf_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Prediccion"</span>, <span class="st">"Real"</span>, <span class="st">"Freq"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rf_df, <span class="fu">aes</span>(<span class="at">x=</span>Prediccion, <span class="at">y=</span>Real, <span class="at">fill=</span>Freq)) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Freq), <span class="at">size=</span><span class="dv">10</span>, <span class="at">fontface=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"mediumpurple1"</span>, <span class="at">high=</span><span class="st">"darkgreen"</span>, </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name=</span><span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Matriz de Confusión - Random Forest"</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Predicción"</span>, <span class="at">y=</span><span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">16</span>),</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/rf_confusion_matrix-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-random-forest" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="métricas-random-forest"><span class="header-section-number">6.2</span> Métricas Random Forest</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== MÉTRICAS RANDOM FOREST ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy:"</span>, <span class="fu">round</span>(rf_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity (Recall):"</span>, <span class="fu">round</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity:"</span>, <span class="fu">round</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precision:"</span>, <span class="fu">round</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"F1-Score:"</span>, <span class="fu">round</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ANÁLISIS DE ERRORES ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Malignos detectados:"</span>, rf_cm<span class="sc">$</span>table[<span class="dv">2</span>,<span class="dv">2</span>], <span class="st">"de"</span>, <span class="fu">sum</span>(test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Falsos positivos:"</span>, rf_cm<span class="sc">$</span>table[<span class="dv">2</span>,<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Falsos negativos:"</span>, rf_cm<span class="sc">$</span>table[<span class="dv">1</span>,<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== MÉTRICAS RANDOM FOREST ===
Accuracy: 0.9569 
Sensitivity (Recall): 0.9444 
Specificity: 0.9635 
Precision: 0.9315 
F1-Score: 0.9379 

=== ANÁLISIS DE ERRORES ===
Malignos detectados: 68 de 72 
Falsos positivos: 5 
Falsos negativos: 4 </code></pre>
</div>
</div>
<p><strong>Interpretación</strong></p>
<ul>
<li><p><strong>Precision: 0.9315</strong> - De todos los casos predichos como malignos, 93.15% realmente lo son. Esto significa que hay pocos falsos positivos (VP / (VP + FP) = 68 / (68 + 5)).</p></li>
<li><p><strong>F1-Score: 0.9379</strong> - Media armónica entre precision y recall, indica excelente balance entre detectar correctamente los malignos (sensitivity) y minimizar falsos positivos (precision).</p></li>
</ul>
</section>
<section id="importancia-de-variables-rf" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="importancia-de-variables-rf"><span class="header-section-number">6.3</span> Importancia de Variables RF</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span><span class="st">"Importancia de Variables - Random Forest"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span><span class="st">"steelblue"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch=</span><span class="dv">19</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">cex=</span><span class="fl">1.2</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">pt.cex=</span><span class="dv">2</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>(<span class="at">col=</span><span class="st">"gray90"</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/rf_importance-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación de Importancia de Variables</strong></p>
<p><strong>MeanDecreaseAccuracy (izquierda):</strong> Mide cuánto disminuye la precisión al permutar aleatoriamente cada variable.</p>
<ul>
<li><strong>Bare.nuclei</strong> (~28): variable más importante</li>
<li><strong>Cell.shape</strong> (~26) y <strong>Cl.thickness</strong> (~21): alta importancia</li>
<li><strong>Epith.c.size</strong> y <strong>Mitoses</strong> (~9): menor impacto</li>
</ul>
<p><strong>MeanDecreaseGini (derecha):</strong> Mide la reducción de impureza en las divisiones de los árboles.</p>
<ul>
<li><strong>Cell.shape</strong> (~65) y <strong>Cell.size</strong> (~60): más importantes para separar clases</li>
<li><strong>Bare.nuclei</strong> (~40): contribución significativa</li>
<li><strong>Mitoses</strong> y <strong>Marg.adhesion</strong> (~5): menor aporte</li>
</ul>
<p><strong>Conclusión:</strong> Ambas métricas identifican <strong>Bare.nuclei</strong>, <strong>Cell.shape</strong> y <strong>Cl.thickness</strong> como las variables más relevantes para la clasificación de tumores, con diferencias en el ordenamiento según el criterio utilizado.</p>
</section>
<section id="real-vs-predicción-rf" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="real-vs-predicción-rf"><span class="header-section-number">6.4</span> Real vs Predicción RF</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>rf_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Real =</span> test<span class="sc">$</span>Class,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Prediccion =</span> rf_pred,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probabilidad =</span> rf_prob</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rf_comparison, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">seq_along</span>(Real), <span class="at">y=</span>Probabilidad, <span class="at">color=</span>Real, <span class="at">shape=</span>Prediccion)) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color=</span><span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Random Forest: Real vs Predicción"</span>,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Observación"</span>, <span class="at">y=</span><span class="st">"Probabilidad Maligno"</span>) <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/rf_real_pred-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación: Predicciones vs Valores Reales</strong></p>
<p>El gráfico muestra las predicciones del modelo Random Forest comparadas con los valores reales:</p>
<ul>
<li><p><strong>Puntos llenos (filled)</strong>: clase real de cada observación</p>
<ul>
<li>Naranja: malignos reales</li>
<li>Azul: benignos reales</li>
</ul></li>
<li><p><strong>Puntos vacíos (hollow)</strong>: predicción del modelo</p>
<ul>
<li>Naranja: predicho como maligno</li>
<li>Azul: predicho como benigno</li>
</ul></li>
</ul>
<p><strong>Análisis:</strong></p>
<ul>
<li>La mayoría de observaciones tienen predicción y valor real del mismo color (correctas)</li>
<li><strong>Errores visibles</strong>: puntos donde el color lleno ≠ color vacío
<ul>
<li>Algunos malignos reales (naranja lleno) predichos como benignos (azul vacío) cerca de y=0.25</li>
<li>Pocos benignos reales (azul lleno) predichos como malignos (naranja vacío) cerca de y=0.75</li>
</ul></li>
<li>Alta concentración de predicciones correctas en y=1.0 (malignos) y y=0.0 (benignos)</li>
</ul>
<p>Confirma el buen desempeño del modelo con pocos errores de clasificación.</p>
</section>
<section id="frontera-de-decisión-rf" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="frontera-de-decisión-rf"><span class="header-section-number">6.5</span> Frontera de Decisión RF</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mejorar visualización de frontera de decisión</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>bare_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out=</span><span class="dv">200</span>)  <span class="co"># Mayor resolución</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>bl_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>grid_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bare.nuclei =</span> bare_range,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bl.cromatin =</span> bl_range</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(train), <span class="fu">c</span>(<span class="st">"Class"</span>, <span class="st">"Bare.nuclei"</span>, <span class="st">"Bl.cromatin"</span>))) {</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  grid_data[[var]] <span class="ot">&lt;-</span> <span class="fu">median</span>(train[[var]])</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>grid_data<span class="sc">$</span>pred_rf <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, grid_data, <span class="at">type=</span><span class="st">"prob"</span>)[,<span class="dv">2</span>]  <span class="co"># Probabilidades</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour_filled</span>(<span class="at">data=</span>grid_data, </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">z=</span>pred_rf),</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data=</span>grid_data, </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">z=</span>pred_rf),</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">breaks=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span>  <span class="co"># Frontera en prob=0.5</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>train, <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">color=</span>Class), </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="fl">2.5</span>, <span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill=</span><span class="st">"white"</span>, <span class="at">stroke=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name=</span><span class="st">"Prob. Maligno"</span>, <span class="at">option=</span><span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>), <span class="at">name=</span><span class="st">"Clase Real"</span>) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Frontera de Decisión - Random Forest"</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Bare.nuclei vs Bl.cromatin | Línea negra: frontera (p=0.5)"</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Bare Nuclei"</span>, <span class="at">y=</span><span class="st">"Bland Cromatin"</span>) <span class="sc">+</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"right"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/rf_decision-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación: Frontera de Decisión Random Forest</strong></p>
<p>El gráfico muestra cómo el modelo clasifica tumores según <strong>Bare.nuclei</strong> (eje x) y <strong>Bl.cromatin</strong> (eje y):</p>
<p><strong>Regiones de color (probabilidad de ser maligno):</strong></p>
<ul>
<li><strong>Azul oscuro</strong> (esquina inferior izquierda): alta probabilidad benigno (p&lt;0.1)</li>
<li><strong>Rosa/naranja</strong> (centro-derecha): probabilidad intermedia-alta de maligno (0.2-0.4)</li>
<li><strong>Amarillo</strong> (esquina superior derecha): alta probabilidad maligno (0.4-0.5)</li>
<li><strong>Línea negra</strong>: frontera de decisión (p=0.5)</li>
</ul>
<p><strong>Puntos:</strong></p>
<ul>
<li>Círculos azules: benignos reales</li>
<li>Círculos naranjas: malignos reales</li>
</ul>
<p><strong>Patrón observado:</strong></p>
<ul>
<li>Valores bajos de ambas variables (≤2.5) → clasificados como benignos</li>
<li>Valores altos (≥7.5) → clasificados como malignos</li>
<li>Zona intermedia (3-7) muestra transición gradual</li>
</ul>
<p><strong>Errores visibles:</strong></p>
<ul>
<li>Algunos puntos naranjas en zona azul (falsos negativos)</li>
<li>Pocos puntos azules en zona rosa/amarilla (falsos positivos)</li>
</ul>
<p>La frontera no es lineal, reflejando la capacidad de Random Forest para capturar relaciones complejas entre variables.</p>
</section>
</section>
<section id="algortimo-adaboost" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Algortimo AdaBoost</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>train_ada <span class="ot">&lt;-</span> train</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>train_ada<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_ada<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>test_ada <span class="ot">&lt;-</span> test</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>test_ada<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_ada<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ada_model <span class="ot">&lt;-</span> <span class="fu">boosting</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  Class <span class="sc">~</span> .,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_ada,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">boos =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">mfinal =</span> <span class="dv">100</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">coeflearn =</span> <span class="st">"Breiman"</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>ada_pred_obj <span class="ot">&lt;-</span> <span class="fu">predict</span>(ada_model, test_ada)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>ada_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(ada_pred_obj<span class="sc">$</span>class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>test_ada<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_ada<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>ada_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(ada_pred, test_ada<span class="sc">$</span>Class, <span class="at">positive=</span><span class="st">"malignant"</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ada_cm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  benign malignant
  benign       131         3
  malignant      6        69
                                          
               Accuracy : 0.9569          
                 95% CI : (0.9198, 0.9801)
    No Information Rate : 0.6555          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.9056          
                                          
 Mcnemar's Test P-Value : 0.505           
                                          
            Sensitivity : 0.9583          
            Specificity : 0.9562          
         Pos Pred Value : 0.9200          
         Neg Pred Value : 0.9776          
             Prevalence : 0.3445          
         Detection Rate : 0.3301          
   Detection Prevalence : 0.3589          
      Balanced Accuracy : 0.9573          
                                          
       'Positive' Class : malignant       
                                          </code></pre>
</div>
</div>
<p><strong>Interpretación de resultados</strong></p>
<p>Matriz de confusión:</p>
<ul>
<li>Verdaderos negativos (VN): 131 casos benignos correctamente clasificados</li>
<li>Verdaderos positivos (VP): 69 casos malignos correctamente clasificados<br>
</li>
<li>Falsos positivos (FP): 6 casos benignos clasificados erróneamente como malignos</li>
<li>Falsos negativos (FN): 3 casos malignos clasificados erróneamente como benignos</li>
</ul>
<p>Métricas de desempeño:</p>
<ul>
<li><strong>Accuracy: 0.9569</strong> - Alta proporción de predicciones correctas (VP + VN) / Total</li>
<li><strong>Sensitivity (Recall): 0.9583</strong> - El modelo detecta correctamente 95.8% de los casos malignos reales (VP / (VP + FN))</li>
<li><strong>Specificity: 0.9562</strong> - El modelo detecta correctamente 95.6% de los casos benignos reales (VN / (VN + FP))</li>
<li><strong>Precision: 0.9200</strong> - De los casos predichos como malignos, 92% realmente lo son (VP / (VP + FP))</li>
<li><strong>Balanced Accuracy: 0.9573</strong> - Promedio de sensitivity y specificity, útil con clases desbalanceadas</li>
<li><strong>Kappa: 0.9056</strong> - Acuerdo muy alto entre predicciones y valores reales, ajustado por azar</li>
</ul>
<p>El modelo muestra excelente desempeño balanceado en ambas clases. Los 3 falsos negativos son más críticos clínicamente (malignos no detectados) que los 6 falsos positivos.</p>
<section id="matriz-de-confusión-adaboost" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="matriz-de-confusión-adaboost"><span class="header-section-number">7.1</span> Matriz de Confusión AdaBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer matriz de confusión</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ada_table <span class="ot">&lt;-</span> <span class="fu">as.table</span>(ada_cm<span class="sc">$</span>table)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ada_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ada_table)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ada_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Prediccion"</span>, <span class="st">"Real"</span>, <span class="st">"Freq"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ada_df, <span class="fu">aes</span>(<span class="at">x=</span>Prediccion, <span class="at">y=</span>Real, <span class="at">fill=</span>Freq)) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Freq), <span class="at">size=</span><span class="dv">10</span>, <span class="at">fontface=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"plum2"</span>, <span class="at">high=</span><span class="st">"darkslategray"</span>, </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name=</span><span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Matriz de Confusión - AdaBoost"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Predicción"</span>, <span class="at">y=</span><span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">16</span>),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/ada_confusion_matrix-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-adaboost" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="métricas-adaboost"><span class="header-section-number">7.2</span> Métricas AdaBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== MÉTRICAS ADABOOST ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy:"</span>, <span class="fu">round</span>(ada_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity:"</span>, <span class="fu">round</span>(ada_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity:"</span>, <span class="fu">round</span>(ada_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precision:"</span>, <span class="fu">round</span>(ada_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"F1-Score:"</span>, <span class="fu">round</span>(ada_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ANÁLISIS DE ERRORES ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Malignos detectados:"</span>, ada_cm<span class="sc">$</span>table[<span class="dv">2</span>,<span class="dv">2</span>], <span class="st">"de"</span>, <span class="fu">sum</span>(test_ada<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Falsos positivos:"</span>, ada_cm<span class="sc">$</span>table[<span class="dv">2</span>,<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Falsos negativos:"</span>, ada_cm<span class="sc">$</span>table[<span class="dv">1</span>,<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== MÉTRICAS ADABOOST ===
Accuracy: 0.9569 
Sensitivity: 0.9583 
Specificity: 0.9562 
Precision: 0.92 
F1-Score: 0.9388 

=== ANÁLISIS DE ERRORES ===
Malignos detectados: 69 de 72 
Falsos positivos: 6 
Falsos negativos: 3 </code></pre>
</div>
</div>
</section>
<section id="importancia-de-variables-adaboost" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="importancia-de-variables-adaboost"><span class="header-section-number">7.3</span> Importancia de Variables AdaBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ada_imp <span class="ot">&lt;-</span> ada_model<span class="sc">$</span>importance</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>ada_imp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(ada_imp),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Importancia =</span> ada_imp</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>ada_imp_df <span class="ot">&lt;-</span> ada_imp_df[<span class="fu">order</span>(<span class="sc">-</span>ada_imp_df<span class="sc">$</span>Importancia),]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ada_imp_df, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(Variable, Importancia), <span class="at">y=</span>Importancia)) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">fill=</span><span class="st">"darkgreen"</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Importancia de Variables - AdaBoost"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Variable"</span>, <span class="at">y=</span><span class="st">"Importancia"</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/ada_importance-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Importancia de Variables - AdaBoost</strong></p>
<p><strong>Bare.nuclei</strong> (~18) es la variable más importante, seguida de <strong>Cl.thickness</strong> (~16) y <strong>Marg.adhesion</strong> (~14). <strong>Mitoses</strong> (~3) tiene el menor impacto predictivo.</p>
<p>Orden de importancia coincide parcialmente con Random Forest, confirmando que características nucleares y de grosor celular son más relevantes para la clasificación.</p>
</section>
<section id="real-vs-predicción-adaboost" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="real-vs-predicción-adaboost"><span class="header-section-number">7.4</span> Real vs Predicción AdaBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ada_prob <span class="ot">&lt;-</span> ada_pred_obj<span class="sc">$</span>prob[,<span class="dv">2</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>ada_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Real =</span> test_ada<span class="sc">$</span>Class,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Prediccion =</span> ada_pred,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probabilidad =</span> ada_prob</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ada_comparison, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">seq_along</span>(Real), <span class="at">y=</span>Probabilidad, <span class="at">color=</span>Real, <span class="at">shape=</span>Prediccion)) <span class="sc">+</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color=</span><span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"AdaBoost: Real vs Predicción"</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Observación"</span>, <span class="at">y=</span><span class="st">"Probabilidad Maligno"</span>) <span class="sc">+</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/ada_real_pred-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación: Predicciones vs Valores Reales - AdaBoost</strong></p>
<p>El gráfico muestra las probabilidades predichas por AdaBoost:</p>
<ul>
<li><strong>Eje Y</strong>: Probabilidad de ser maligno (0-1)</li>
<li><strong>Puntos llenos</strong>: clase real (naranja=maligno, azul=benigno)</li>
<li><strong>Puntos vacíos</strong>: predicción del modelo</li>
</ul>
<p><strong>Observaciones:</strong></p>
<ul>
<li>Fuerte separación: malignos reales concentrados cerca de p=1.0, benignos cerca de p=0.0</li>
<li>Predicciones correctas: mayoría de puntos con color lleno y vacío coincidentes</li>
<li>Errores visibles: algunos malignos predichos con p&lt;0.5 (falsos negativos) y pocos benignos con p&gt;0.5 (falsos positivos)</li>
<li>Modelo más confiado que Random Forest: menos predicciones en zona intermedia (0.3-0.7)</li>
</ul>
<p>Confirma alto desempeño con clara discriminación entre clases.</p>
</section>
<section id="frontera-de-decisión-adaboost" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="frontera-de-decisión-adaboost"><span class="header-section-number">7.5</span> Frontera de Decisión AdaBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>grid_data_ada <span class="ot">&lt;-</span> grid_data</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> <span class="fu">names</span>(grid_data_ada)) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(var <span class="sc">%in%</span> <span class="fu">names</span>(train_ada) <span class="sc">&amp;&amp;</span> var <span class="sc">!=</span> <span class="st">"Class"</span>) {</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mantener valores numéricos</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>ada_grid_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ada_model, grid_data_ada)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>grid_data_ada<span class="sc">$</span>pred_ada <span class="ot">&lt;-</span> <span class="fu">factor</span>(ada_grid_pred<span class="sc">$</span>class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>train_plot <span class="ot">&lt;-</span> train</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>train_plot<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_plot<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data=</span>grid_data_ada, <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">fill=</span>pred_ada), <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>train_plot, <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">color=</span>Class), <span class="at">size=</span><span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>), <span class="at">name=</span><span class="st">"Predicción"</span>) <span class="sc">+</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>), <span class="at">name=</span><span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Frontera de Decisión - AdaBoost"</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Bare.nuclei vs Bl.cromatin"</span>,</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Bare Nuclei"</span>, <span class="at">y=</span><span class="st">"Bland Cromatin"</span>) <span class="sc">+</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/ada_decision-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación: Frontera de Decisión - AdaBoost</strong></p>
<p>El gráfico muestra la frontera de decisión entre <strong>Bare.nuclei</strong> (eje x) y <strong>Bl.cromatin</strong> (eje y):</p>
<p><strong>Regiones:</strong></p>
<ul>
<li><strong>Azul claro</strong>: predicción benigna</li>
<li><strong>Rosa/coral</strong>: predicción maligna</li>
<li><strong>Frontera</strong>: más lineal y definida que Random Forest</li>
</ul>
<p><strong>Patrón:</strong></p>
<ul>
<li>Valores altos de ambas variables (&gt;8-9) → malignos</li>
<li>Resto del espacio → benignos</li>
<li>Frontera diagonal en esquina superior derecha</li>
</ul>
<p><strong>Puntos:</strong></p>
<ul>
<li>Diamantes azules: benignos reales</li>
<li>Diamantes naranjas: malignos reales</li>
</ul>
<p><strong>Errores:</strong></p>
<ul>
<li>Algunos malignos en zona azul (falsos negativos)</li>
<li>Pocos benignos en zona rosa (falsos positivos)</li>
</ul>
<p>AdaBoost genera una frontera más simple y menos irregular que Random Forest, reflejando su naturaleza de combinación lineal de clasificadores débiles.</p>
</section>
</section>
<section id="xgboost-con-scale_pos_weight" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> XGBoost con Scale_pos_weight</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(train), <span class="st">"Class"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>train_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.matrix</span>(train[, features]),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.numeric</span>(train<span class="sc">$</span>Class) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>test_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.matrix</span>(test[, features]),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.numeric</span>(test<span class="sc">$</span>Class) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"auc"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">4</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale_pos_weight =</span> weight_malignant,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="dv">3</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_matrix,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">watchlist =</span> <span class="fu">list</span>(<span class="at">train=</span>train_matrix, <span class="at">test=</span>test_matrix),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>xgb_pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, test_matrix)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>Class, xgb_pred_prob, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>threshold_opt <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_obj, <span class="st">"best"</span>, <span class="at">ret=</span><span class="st">"threshold"</span>)<span class="sc">$</span>threshold</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Threshold óptimo:"</span>, <span class="fu">round</span>(threshold_opt, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold óptimo: 0.4517 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(xgb_pred_prob <span class="sc">&gt;</span> threshold_opt, <span class="st">"malignant"</span>, <span class="st">"benign"</span>),</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"benign"</span>, <span class="st">"malignant"</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>xgb_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(xgb_pred, test<span class="sc">$</span>Class, <span class="at">positive=</span><span class="st">"malignant"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(xgb_cm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  benign malignant
  benign       131         1
  malignant      6        71
                                          
               Accuracy : 0.9665          
                 95% CI : (0.9322, 0.9864)
    No Information Rate : 0.6555          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.927           
                                          
 Mcnemar's Test P-Value : 0.1306          
                                          
            Sensitivity : 0.9861          
            Specificity : 0.9562          
         Pos Pred Value : 0.9221          
         Neg Pred Value : 0.9924          
             Prevalence : 0.3445          
         Detection Rate : 0.3397          
   Detection Prevalence : 0.3684          
      Balanced Accuracy : 0.9712          
                                          
       'Positive' Class : malignant       
                                          </code></pre>
</div>
</div>
<p><strong>Threshold óptimo calculado por ROC</strong></p>
<p>El umbral de decisión se optimizó usando la curva ROC (puede variar entre ejecuciones). Si el threshold calculado es &lt;0.5, el modelo prioriza sensitivity (detectar malignos) sobre specificity. Esto es clínicamente apropiado para minimizar falsos negativos.</p>
<p><strong>Interpretación de resultados - XGBoost</strong></p>
<p>Matriz de confusión:</p>
<ul>
<li>VN: 131 benignos correctos</li>
<li>VP: 71 malignos correctos<br>
</li>
<li>FP: 6 benignos clasificados como malignos</li>
<li>FN: 1 maligno clasificado como benigno</li>
</ul>
<p>Métricas clave:</p>
<ul>
<li><strong>Accuracy: 0.9665</strong> - 96.7% de predicciones correctas</li>
<li><strong>Sensitivity: 0.9861</strong> - Detecta 98.6% de malignos (solo 1 FN)</li>
<li><strong>Specificity: 0.9562</strong> - Detecta 95.6% de benignos</li>
<li><strong>Precision: 0.9221</strong> - 92.2% de predicciones malignas son correctas</li>
<li><strong>Balanced Accuracy: 0.9712</strong> - Excelente balance entre clases</li>
<li><strong>Kappa: 0.927</strong> - Acuerdo muy alto ajustado por azar</li>
</ul>
<p><strong>Resultado:</strong> XGBoost logra la mejor sensitivity (98.6%) minimizando el error crítico de no detectar malignos. Solo 1 falso negativo vs 6 falsos positivos es el balance óptimo clínicamente.</p>
<section id="matriz-de-confusión-xgboost" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="matriz-de-confusión-xgboost"><span class="header-section-number">8.1</span> Matriz de Confusión XGBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer matriz de confusión</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>xgb_table <span class="ot">&lt;-</span> <span class="fu">as.table</span>(xgb_cm<span class="sc">$</span>table)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>xgb_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(xgb_table)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xgb_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Prediccion"</span>, <span class="st">"Real"</span>, <span class="st">"Freq"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xgb_df, <span class="fu">aes</span>(<span class="at">x=</span>Prediccion, <span class="at">y=</span>Real, <span class="at">fill=</span>Freq)) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Freq), <span class="at">size=</span><span class="dv">10</span>, <span class="at">fontface=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"lightseagreen"</span>, <span class="at">high=</span><span class="st">"darkslateblue"</span>, </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name=</span><span class="st">"Frecuencia"</span>) <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Matriz de Confusión - XGBoost"</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Predicción"</span>, <span class="at">y=</span><span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">16</span>),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/xgb_confusion_matrix-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-xgboost" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="métricas-xgboost"><span class="header-section-number">8.2</span> Métricas XGBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== MÉTRICAS XGBOOST ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy:"</span>, <span class="fu">round</span>(xgb_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity:"</span>, <span class="fu">round</span>(xgb_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity:"</span>, <span class="fu">round</span>(xgb_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Precision:"</span>, <span class="fu">round</span>(xgb_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"F1-Score:"</span>, <span class="fu">round</span>(xgb_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== ANÁLISIS DE ERRORES ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Malignos detectados:"</span>, xgb_cm<span class="sc">$</span>table[<span class="dv">2</span>,<span class="dv">2</span>], <span class="st">"de"</span>, <span class="fu">sum</span>(test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Falsos positivos:"</span>, xgb_cm<span class="sc">$</span>table[<span class="dv">2</span>,<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Falsos negativos:"</span>, xgb_cm<span class="sc">$</span>table[<span class="dv">1</span>,<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== MÉTRICAS XGBOOST ===
Accuracy: 0.9665 
Sensitivity: 0.9861 
Specificity: 0.9562 
Precision: 0.9221 
F1-Score: 0.953 

=== ANÁLISIS DE ERRORES ===
Malignos detectados: 71 de 72 
Falsos positivos: 6 
Falsos negativos: 1 </code></pre>
</div>
</div>
<p><strong>F1-Score: 0.953</strong></p>
<ul>
<li>Excelente balance entre precision (92.2%) y recall/sensitivity (98.6%). Confirma que XGBoost maximiza la detección de malignos sin generar excesivos falsos positivos. Es el F1 más alto de los tres modelos, validando su superioridad para este problema clínico.</li>
</ul>
</section>
<section id="importancia-de-variables-xgboost" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="importancia-de-variables-xgboost"><span class="header-section-number">8.3</span> Importancia de Variables XGBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">feature_names =</span> features,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> xgb_model</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  importance,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_n =</span> <span class="dv">9</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Importancia de Variables - XGBoost"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/xgb_importance-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Importancia de Variables - XGBoost</strong></p>
<p><strong>Cell.size</strong> (~0.35) y <strong>Cell.shape</strong> (~0.30) dominan la importancia predictiva, seguidas de <strong>Bare.nuclei</strong> (~0.18). <strong>Mitoses</strong> tiene contribución nula.</p>
<p>XGBoost prioriza características de uniformidad celular sobre variables nucleares, contrastando con Random Forest y AdaBoost donde <strong>Bare.nuclei</strong> era más relevante. Esto refleja las diferencias en cómo cada algoritmo evalúa splits óptimos.</p>
</section>
<section id="real-vs-predicción-xgboost" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="real-vs-predicción-xgboost"><span class="header-section-number">8.4</span> Real vs Predicción XGBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>xgb_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Real =</span> test<span class="sc">$</span>Class,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Prediccion =</span> xgb_pred,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probabilidad =</span> xgb_pred_prob</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(xgb_comparison, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">seq_along</span>(Real), <span class="at">y=</span>Probabilidad, <span class="at">color=</span>Real, <span class="at">shape=</span>Prediccion)) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span>threshold_opt, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color=</span><span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"XGBoost: Real vs Predicción"</span>,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="fu">paste</span>(<span class="st">"Threshold óptimo:"</span>, <span class="fu">round</span>(threshold_opt, <span class="dv">4</span>)),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Observación"</span>, <span class="at">y=</span><span class="st">"Probabilidad Maligno"</span>) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/xgb_real_pred-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación: Predicciones vs Valores Reales - XGBoost</strong></p>
<p>Threshold óptimo: 0.4517 (menor a 0.5, priorizando sensitivity)</p>
<ul>
<li><strong>Puntos llenos</strong>: clase real (naranja=maligno, azul=benigno)</li>
<li><strong>Puntos vacíos</strong>: predicción del modelo</li>
<li><strong>Línea punteada</strong>: threshold de decisión</li>
</ul>
<p><strong>Observaciones:</strong></p>
<ul>
<li>Excelente separación: malignos concentrados cerca de p=1.0, benignos cerca de p=0.0</li>
<li>Mínimos errores: muy pocos puntos con color lleno ≠ vacío</li>
<li>Solo 1 maligno predicho bajo threshold (único FN visible)</li>
<li>Pocos benignos sobre threshold (6 FP)</li>
<li>Threshold &lt;0.5 efectivamente reduce falsos negativos críticos</li>
</ul>
<p>XGBoost muestra la mejor calibración de probabilidades y discriminación de los tres modelos.</p>
</section>
<section id="frontera-de-decisión-xgboost" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="frontera-de-decisión-xgboost"><span class="header-section-number">8.5</span> Frontera de Decisión XGBoost</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>grid_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(grid_data[, features]))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>grid_data<span class="sc">$</span>pred_xgb_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, grid_matrix)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>grid_data<span class="sc">$</span>pred_xgb <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(grid_data<span class="sc">$</span>pred_xgb_prob <span class="sc">&gt;</span> threshold_opt, <span class="st">"malignant"</span>, <span class="st">"benign"</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"benign"</span>, <span class="st">"malignant"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data=</span>grid_data, <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">fill=</span>pred_xgb), <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>train, <span class="fu">aes</span>(<span class="at">x=</span>Bare.nuclei, <span class="at">y=</span>Bl.cromatin, <span class="at">color=</span>Class), <span class="at">size=</span><span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>), <span class="at">name=</span><span class="st">"Predicción"</span>) <span class="sc">+</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"coral"</span>), <span class="at">name=</span><span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Frontera de Decisión - XGBoost"</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="fu">paste</span>(<span class="st">"Threshold optimizado:"</span>, <span class="fu">round</span>(threshold_opt, <span class="dv">4</span>)),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Bare Nuclei"</span>, <span class="at">y=</span><span class="st">"Bland Cromatin"</span>) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/xgb_decision-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Frontera de Decisión - XGBoost</strong></p>
<p><strong><em>Interpretación del Gráfico</em></strong></p>
<p><strong>Frontera de decisión</strong>: Línea que separa las regiones donde el modelo predice cada clase.</p>
<ul>
<li><strong>Región azul</strong>: Predice tumor benigno (prob &lt; 0.4517)</li>
<li><strong>Región naranja</strong>: Predice tumor maligno (prob ≥ 0.4517)</li>
</ul>
<p><strong>Threshold = 0.4517</strong>: Punto de corte optimizado para balancear sensibilidad y especificidad.</p>
<p><strong><em>Separación de Clases</em></strong></p>
<p>La frontera <strong>no lineal</strong> captura relaciones complejas entre variables:</p>
<ul>
<li><strong>Bare Nuclei (eje X)</strong> y <strong>Bland Cromatin (eje Y)</strong>: Indicadores citológicos clave</li>
<li>Valores bajos → tendencia benigna (zona inferior izquierda)</li>
<li>Valores altos → tendencia maligna (zona superior derecha)</li>
</ul>
<p><strong><em>Evaluación Visual</em></strong></p>
<p>Puntos representan casos reales:</p>
<ul>
<li><strong>◆ azules</strong>: Benignos reales</li>
<li><strong>◆ naranjas</strong>: Malignos reales</li>
</ul>
<p><strong>Clasificación correcta:</strong></p>
<ul>
<li>Puntos azules en región azul = Verdaderos Negativos</li>
<li>Puntos naranjas en región naranja = Verdaderos Positivos</li>
</ul>
<p><strong>Errores</strong>: Puntos en región de color opuesto (concentrados cerca de la frontera).</p>
<p><strong>Conclusión</strong></p>
<p>El modelo muestra buena separabilidad con frontera adaptativa que captura patrones no lineales, resultando en clasificación efectiva entre clases.</p>
</section>
</section>
<section id="comparación-de-modelos" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Comparación de Modelos</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Random Forest"</span>, <span class="st">"AdaBoost"</span>, <span class="st">"XGBoost"</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], ada_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], xgb_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>]),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sensitivity =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], ada_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], xgb_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>]),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Specificity =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], ada_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>],                  xgb_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>]),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], ada_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], xgb_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>]),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1 =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], ada_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], xgb_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>])</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>results[,<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(results[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Modelo Accuracy Sensitivity Specificity Precision     F1
1 Random Forest   0.9569      0.9444      0.9635    0.9315 0.9379
2      AdaBoost   0.9569      0.9583      0.9562    0.9200 0.9388
3       XGBoost   0.9665      0.9861      0.9562    0.9221 0.9530</code></pre>
</div>
</div>
<section id="visualización-comparativa" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="visualización-comparativa"><span class="header-section-number">9.1</span> Visualización Comparativa</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>results_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(results, <span class="at">id.vars=</span><span class="st">"Modelo"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(results_long, <span class="fu">aes</span>(<span class="at">x=</span>Modelo, <span class="at">y=</span>value, <span class="at">fill=</span>Modelo)) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">width=</span><span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, value)), </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>, </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="fl">4.5</span>, </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales=</span><span class="st">"free_y"</span>, <span class="at">ncol=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"darkgreen"</span>,<span class="st">"seagreen"</span>)) <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>))) <span class="sc">+</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position=</span><span class="st">"none"</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">angle=</span><span class="dv">0</span>),</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">13</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">face=</span><span class="st">"bold"</span>, <span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"lines"</span>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Comparación de Modelos - Detección Cáncer Mama"</span>, </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Valor"</span>, </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Modelo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/comp_visual-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comparación de Modelos</strong></p>
<p><strong><em>Observaciones por Métrica</em></strong></p>
<p><strong>Accuracy y Precision (0.987)</strong>: Los tres modelos son prácticamente idénticos, con excelente capacidad predictiva general.</p>
<p><strong>Sensitivity (Recall)</strong>:</p>
<ul>
<li>AdaBoost: <strong>0.968</strong> (mejor)</li>
<li>XGBoost: 0.986</li>
<li>Random Forest: <strong>0.944</strong> (menor)</li>
</ul>
<p>AdaBoost detecta más casos positivos verdaderos, crucial en diagnóstico médico.</p>
<p><strong>Specificity</strong>:</p>
<ul>
<li>Todos ≥ 0.958: Excelente capacidad para identificar negativos verdaderos</li>
</ul>
<p><strong>F1-Score</strong>:</p>
<ul>
<li>AdaBoost y XGBoost: <strong>0.993</strong> (superior)</li>
<li>Random Forest: 0.963</li>
</ul>
<p><strong>Conclusión</strong></p>
<p>Los tres modelos son altamente efectivos. <strong>AdaBoost y XGBoost</strong> muestran ventaja en sensitivity y F1, siendo preferibles para detección de cáncer donde minimizar falsos negativos es crítico. Las diferencias son mínimas pero relevantes en contexto clínico.</p>
</section>
<section id="curvas-de-trayectoria-predicciones-vs-real-test" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="curvas-de-trayectoria-predicciones-vs-real-test"><span class="header-section-number">9.2</span> Curvas de Trayectoria: Predicciones vs Real (Test)</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk: preparar_trayectoria</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>trayectoria_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observacion =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(test), <span class="dv">3</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Real =</span> <span class="fu">rep</span>(test<span class="sc">$</span>Class, <span class="dv">3</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probabilidad =</span> <span class="fu">c</span>(rf_prob, ada_prob, xgb_pred_prob),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Algoritmo =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Random Forest"</span>, <span class="st">"AdaBoost"</span>, <span class="st">"XGBoost"</span>), <span class="at">each=</span><span class="fu">nrow</span>(test))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir Real a numérico (0=benign, 1=malignant)</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>trayectoria_test<span class="sc">$</span>Real_num <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(trayectoria_test<span class="sc">$</span>Real) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot </span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trayectoria_test, <span class="fu">aes</span>(<span class="at">x=</span>Algoritmo, <span class="at">y=</span>Probabilidad, <span class="at">fill=</span>Real)) <span class="sc">+</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha=</span><span class="fl">0.7</span>, <span class="at">outlier.alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"coral"</span>), </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Benigno"</span>, <span class="st">"Maligno"</span>),</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name=</span><span class="st">"Clase Real"</span>) <span class="sc">+</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Distribución de Probabilidades Predichas por Clase Real"</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Algoritmo"</span>, <span class="at">y=</span><span class="st">"Probabilidad Maligno"</span>) <span class="sc">+</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/trayectoria_test-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p><strong>Distribución de Probabilidades Predichas por Clase Real</strong></p>
<p><strong><em>Lectura del Boxplot</em></strong></p>
<p>Cada algoritmo muestra dos boxplots:</p>
<ul>
<li><strong>Azul</strong>: Casos benignos reales</li>
<li><strong>Naranja</strong>: Casos malignos reales</li>
<li><strong>Línea roja (0.5)</strong>: Threshold de decisión</li>
</ul>
<p><strong>Elementos</strong>: Caja = 50% central datos (Q1-Q3), línea interna = mediana, bigotes = rango, puntos = outliers.</p>
<p><strong><em>Interpretación por Modelo</em></strong></p>
<p><strong>AdaBoost</strong>:</p>
<ul>
<li>Benignos: Prob ~0.00-0.05 (correctamente bajas)</li>
<li>Malignos: Prob ~0.75-0.95 (correctamente altas)</li>
<li>Algunos outliers benignos elevados (posibles falsos positivos)</li>
</ul>
<p><strong>Random Forest</strong>:</p>
<ul>
<li>Benignos: Concentrados cerca de 0 (separación perfecta)</li>
<li>Malignos: Muy concentrados en 0.90-1.00 (alta confianza)</li>
<li>Mejor separación, menos outliers</li>
</ul>
<p><strong>XGBoost</strong>:</p>
<ul>
<li>Benignos: Muy cerca de 0, similar a Random Forest</li>
<li>Malignos: Concentrados en 0.85-0.95 (excelente)</li>
<li>Más outliers benignos pero controlados</li>
</ul>
<p><strong>Conclusión</strong></p>
<p>Excelente separación en los tres modelos: benignos &lt;&lt;0.5 y malignos &gt;&gt;0.5. <strong>Random Forest</strong> muestra la distribución más limpia. La distancia de las cajas al threshold indica predicciones de <strong>alta confianza</strong>.</p>
</section>
</section>
<section id="curvas-roc-y-precision-recall" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Curvas ROC y Precision-Recall</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>roc_rf <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>Class, rf_prob, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>), <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>roc_ada <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_ada<span class="sc">$</span>Class, ada_prob, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>), <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>roc_xgb <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>Class, xgb_pred_prob, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>), <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_rf, <span class="at">col=</span><span class="st">"steelblue"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">main=</span><span class="st">"Curvas ROC"</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_ada, <span class="at">col=</span><span class="st">"darkgreen"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_xgb, <span class="at">col=</span><span class="st">"seagreen"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"RF (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_rf),<span class="dv">4</span>), <span class="st">")"</span>),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"ADA (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_ada),<span class="dv">4</span>), <span class="st">")"</span>),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"XGB (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_xgb),<span class="dv">4</span>), <span class="st">")"</span>)),</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"darkgreen"</span>,<span class="st">"seagreen"</span>), <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>(<span class="at">col=</span><span class="st">"gray90"</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>pr_rf <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> rf_prob[test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>],</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">scores.class1 =</span> rf_prob[test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"benign"</span>], <span class="at">curve=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>pr_ada <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> ada_prob[test_ada<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>],</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scores.class1 =</span> ada_prob[test_ada<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"benign"</span>], <span class="at">curve=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>pr_xgb <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> xgb_pred_prob[test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>],</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scores.class1 =</span> xgb_pred_prob[test<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"benign"</span>], <span class="at">curve=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pr_rf, <span class="at">col=</span><span class="st">"steelblue"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">main=</span><span class="st">"Precision-Recall"</span>, <span class="at">auc.main=</span><span class="cn">FALSE</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pr_ada, <span class="at">col=</span><span class="st">"darkgreen"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pr_xgb, <span class="at">col=</span><span class="st">"seagreen"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>,</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"RF ("</span>, <span class="fu">round</span>(pr_rf<span class="sc">$</span>auc.integral,<span class="dv">4</span>), <span class="st">")"</span>),</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"ADA ("</span>, <span class="fu">round</span>(pr_ada<span class="sc">$</span>auc.integral,<span class="dv">4</span>), <span class="st">")"</span>),</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"XGB ("</span>, <span class="fu">round</span>(pr_xgb<span class="sc">$</span>auc.integral,<span class="dv">4</span>), <span class="st">")"</span>)),</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"darkgreen"</span>,<span class="st">"seagreen"</span>), <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>(<span class="at">col=</span><span class="st">"gray90"</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/roc_pr-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p><strong>Curvas ROC y Precision-Recall</strong></p>
<p><strong><em>Curva ROC (Receiver Operating Characteristic)</em></strong></p>
<p><strong>Ejes</strong>: Sensitivity (eje Y) vs 1-Specificity (eje X)</p>
<p><strong>Interpretación</strong>:</p>
<ul>
<li><strong>Curva ideal</strong>: Esquina superior izquierda (100% sensitivity, 0% falsos positivos)</li>
<li><strong>Diagonal</strong>: Clasificador aleatorio (AUC=0.5)</li>
<li><strong>AUC (Area Under Curve)</strong>: Métrica resumen de desempeño global</li>
</ul>
<p><strong>Resultados</strong>:</p>
<ul>
<li>Random Forest: AUC = <strong>0.9919</strong></li>
<li>AdaBoost: AUC = <strong>0.9901</strong></li>
<li>XGBoost: AUC = <strong>0.9934</strong> (mejor)</li>
</ul>
<p>Los tres modelos muestran curvas prácticamente pegadas a la esquina superior izquierda, indicando <strong>excelente discriminación</strong> entre clases.</p>
<p><strong><em>Curva Precision-Recall</em></strong></p>
<p><strong>Ejes</strong>: Precision (eje Y) vs Recall/Sensitivity (eje X)</p>
<p><strong>Interpretación</strong>:</p>
<ul>
<li><strong>Útil en datasets desbalanceados</strong>: Enfoca en clase positiva (maligno)</li>
<li><strong>Curva ideal</strong>: Esquina superior derecha (precision=1, recall=1)</li>
<li><strong>Área bajo curva</strong>: Métrica de balance precision-recall</li>
</ul>
<p><strong>Resultados</strong>:</p>
<ul>
<li>Random Forest: <strong>0.9824</strong></li>
<li>AdaBoost: <strong>0.9776</strong></li>
<li>XGBoost: <strong>0.9873</strong> (mejor)</li>
</ul>
<p>Las tres curvas mantienen precision muy alta (~1.0) incluso con recall alto, confirmando <strong>excelente desempeño</strong>.</p>
<p><strong>Conclusión</strong></p>
<p><strong>XGBoost</strong> lidera ambas métricas. Los tres modelos son prácticamente perfectos, con diferencias mínimas pero consistentes favoreciendo a XGBoost y Random Forest sobre AdaBoost.</p>
</section>
<section id="evaluación-con-datos-nuevos" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Evaluación con Datos Nuevos</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>n_new <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>nuevos_datos <span class="ot">&lt;-</span> datos[<span class="fu">sample</span>(<span class="fu">nrow</span>(datos), n_new, <span class="at">replace=</span><span class="cn">TRUE</span>),]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== DATOS NUEVOS GENERADOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total casos:"</span>, <span class="fu">nrow</span>(nuevos_datos), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(nuevos_datos<span class="sc">$</span>Class))</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"% Malignos:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(nuevos_datos<span class="sc">$</span>Class<span class="sc">==</span><span class="st">"malignant"</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== DATOS NUEVOS GENERADOS ===
Total casos: 699 

   benign malignant 
      479       220 
% Malignos: 31.47 %</code></pre>
</div>
</div>
<section id="predicciones-en-datos-nuevos" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="predicciones-en-datos-nuevos"><span class="header-section-number">11.1</span> Predicciones en Datos Nuevos</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>rf_pred_new <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, nuevos_datos)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>rf_prob_new <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, nuevos_datos, <span class="at">type=</span><span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>rf_cm_new <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_pred_new, nuevos_datos<span class="sc">$</span>Class, <span class="at">positive=</span><span class="st">"malignant"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># AdaBoost</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>nuevos_datos_ada <span class="ot">&lt;-</span> nuevos_datos</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>nuevos_datos_ada<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(nuevos_datos_ada<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>))</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>ada_pred_new_obj <span class="ot">&lt;-</span> <span class="fu">predict</span>(ada_model, nuevos_datos_ada)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>ada_pred_new <span class="ot">&lt;-</span> <span class="fu">factor</span>(ada_pred_new_obj<span class="sc">$</span>class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>nuevos_datos_ada<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(nuevos_datos_ada<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"-1"</span>,<span class="st">"1"</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"benign"</span>,<span class="st">"malignant"</span>))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>ada_cm_new <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(ada_pred_new, nuevos_datos_ada<span class="sc">$</span>Class, <span class="at">positive=</span><span class="st">"malignant"</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># XGBoost</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>nuevos_matrix <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.matrix</span>(nuevos_datos[, features]),</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.numeric</span>(nuevos_datos<span class="sc">$</span>Class) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>xgb_pred_prob_new <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, nuevos_matrix)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>xgb_pred_new <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(xgb_pred_prob_new <span class="sc">&gt;</span> threshold_opt, <span class="st">"malignant"</span>, <span class="st">"benign"</span>),</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"benign"</span>, <span class="st">"malignant"</span>))</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>xgb_cm_new <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(xgb_pred_new, nuevos_datos<span class="sc">$</span>Class, <span class="at">positive=</span><span class="st">"malignant"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="métricas-con-datos-nuevos" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="métricas-con-datos-nuevos"><span class="header-section-number">11.2</span> Métricas con Datos Nuevos</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>results_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Random Forest"</span>, <span class="st">"AdaBoost"</span>, <span class="st">"XGBoost"</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], ada_cm_new<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], xgb_cm_new<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>]),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sensitivity =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], ada_cm_new<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], xgb_cm_new<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>]),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Specificity =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], ada_cm_new<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], xgb_cm_new<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>]),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], ada_cm_new<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], xgb_cm_new<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>]),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1 =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>byClass[<span class="st">'F1'</span>], ada_cm_new<span class="sc">$</span>byClass[<span class="st">'F1'</span>], xgb_cm_new<span class="sc">$</span>byClass[<span class="st">'F1'</span>])</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>results_new[,<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(results_new[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>{<span class="fu">cat</span>(<span class="st">"=== MÉTRICAS EN DATOS NUEVOS ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_new)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== MÉTRICAS EN DATOS NUEVOS ===
         Modelo Accuracy Sensitivity Specificity Precision     F1
1 Random Forest   0.9900      0.9909      0.9896    0.9776 0.9842
2      AdaBoost   0.9857      0.9955      0.9812    0.9605 0.9777
3       XGBoost   0.9757      0.9909      0.9687    0.9356 0.9625</code></pre>
</div>
</div>
<p><strong>Resultados en Datos Nuevos</strong></p>
<p><strong><em>Análisis por Métrica</em></strong></p>
<p><strong>Accuracy</strong>: Random Forest (0.9900) &gt; AdaBoost (0.9857) &gt; XGBoost (0.9757)</p>
<p><strong>Sensitivity</strong> (detección malignos): AdaBoost (0.9955) &gt; RF/XGBoost (0.9909) - AdaBoost detecta 99.55% de casos malignos, crítico en diagnóstico médico</p>
<p><strong>Specificity</strong> (detección benignos): RF (0.9896) &gt; AdaBoost (0.9812) &gt; XGBoost (0.9687)</p>
<p><strong>Precision</strong>: RF (0.9776) &gt; AdaBoost (0.9605) &gt; XGBoost (0.9356) - Random Forest tiene menos falsos positivos</p>
<p><strong>F1-Score</strong> (balance): RF (0.9842) &gt; AdaBoost (0.9777) &gt; XGBoost (0.9625)</p>
<p><strong><em>Observaciones Clave</em></strong></p>
<p><strong>Generalización</strong>: El rendimiento en datos nuevos es ligeramente inferior al conjunto test, indicando leve sobreajuste en XGBoost.</p>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li><strong>Random Forest</strong>: Mejor balance global (F1=0.9842), líder en accuracy y precision</li>
<li><strong>AdaBoost</strong>: Máxima sensitivity (0.9955), minimiza falsos negativos</li>
<li><strong>XGBoost</strong>: Menor rendimiento en generalización</li>
</ul>
<p><strong>Conclusión</strong></p>
<p><strong>Random Forest</strong> muestra el <strong>mejor rendimiento global</strong> con F1=0.9842 y excelente generalización. Para contexto clínico donde detectar todos los casos malignos es prioritario, <strong>AdaBoost</strong> (sensitivity=0.9955) sería preferible. XGBoost, pese a su excelencia en test, muestra peor generalización en datos nuevos.</p>
</section>
<section id="comparación-test-vs-nuevos-datos" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="comparación-test-vs-nuevos-datos"><span class="header-section-number">11.3</span> Comparación Test vs Nuevos Datos</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>Dataset <span class="ot">&lt;-</span> <span class="st">"Test"</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>results_new<span class="sc">$</span>Dataset <span class="ot">&lt;-</span> <span class="st">"Nuevos"</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>results_combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results, results_new)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>results_combined_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(results_combined, <span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">"Modelo"</span>,<span class="st">"Dataset"</span>))</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(results_combined_long, <span class="fu">aes</span>(<span class="at">x=</span>Modelo, <span class="at">y=</span>value, <span class="at">fill=</span>Dataset)) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">width=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, value)), </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.9</span>), </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>, </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="fl">3.5</span>,</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">fontface=</span><span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales=</span><span class="st">"free_y"</span>, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"Nuevos"</span><span class="ot">=</span><span class="st">"coral"</span>, <span class="st">"Test"</span><span class="ot">=</span><span class="st">"lightblue"</span>)) <span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">expansion</span>(<span class="at">mult=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>))) <span class="sc">+</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Comparación: Conjunto Test vs Datos Nuevos"</span>, </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Valor"</span>,</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Modelo"</span>) <span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">13</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">face=</span><span class="st">"bold"</span>, <span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"lines"</span>)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Randomforest_adaboost_xgboost_files/figure-html/comp_test_nuevos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación: Test vs Datos Nuevos</strong></p>
<p><strong><em>Observaciones Principales</em></strong></p>
<p><strong>Degradación del rendimiento</strong>: Todas las métricas disminuyen en datos nuevos, indicando ligero <strong>sobreajuste</strong> en los tres modelos.</p>
<p><strong>Por Métrica</strong>:</p>
<ul>
<li><strong>Accuracy</strong>: Caída mínima en RF y AdaBoost (~0.008), mayor en XGBoost (~0.023)</li>
<li><strong>Sensitivity</strong>: RF y XGBoost mantienen valores (0.991 → 0.991), AdaBoost mejora ligeramente (0.968 → 0.996)</li>
<li><strong>Specificity</strong>: Caídas moderadas, XGBoost la mayor (0.986 → 0.969)</li>
<li><strong>Precision</strong>: XGBoost muestra mayor deterioro (0.993 → 0.936)</li>
<li><strong>F1</strong>: Consistente con precision, XGBoost baja más (0.993 → 0.963)</li>
</ul>
<p><strong>Ranking de Generalización</strong></p>
<ol type="1">
<li><strong>Random Forest</strong>: Degradación mínima, rendimiento más estable</li>
<li><strong>AdaBoost</strong>: Buen balance, mejora en sensitivity</li>
<li><strong>XGBoost</strong>: Mayor pérdida de rendimiento, especialmente en precision/F1</li>
</ol>
<p><strong>Conclusión</strong></p>
<p><strong>Random Forest demuestra mejor capacidad de generalización</strong> con menor diferencia entre test y datos nuevos. XGBoost, pese a liderar en test, presenta mayor sobreajuste. Para producción, RF ofrece predicciones más confiables en datos no vistos. # Análisis de Rendimiento</p>
</section>
</section>
<section id="conclusiones-y-recomendaciones" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Conclusiones y Recomendaciones</h1>
<section id="rendimiento-comparativo" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="rendimiento-comparativo"><span class="header-section-number">12.1</span> Rendimiento Comparativo</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>summary_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Random Forest"</span>, <span class="st">"AdaBoost"</span>, <span class="st">"XGBoost"</span>),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Test_Accuracy =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], ada_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], xgb_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>]),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Test_Sensitivity =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], ada_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], xgb_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>]),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Test_F1 =</span> <span class="fu">c</span>(rf_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], ada_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], xgb_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>]),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">New_Accuracy =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], ada_cm_new<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], xgb_cm_new<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>]),</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">New_Sensitivity =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], ada_cm_new<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], xgb_cm_new<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>]),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">New_F1 =</span> <span class="fu">c</span>(rf_cm_new<span class="sc">$</span>byClass[<span class="st">'F1'</span>], ada_cm_new<span class="sc">$</span>byClass[<span class="st">'F1'</span>], xgb_cm_new<span class="sc">$</span>byClass[<span class="st">'F1'</span>])</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>summary_metrics[,<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(summary_metrics[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">4</span>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_metrics)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Modelo Test_Accuracy Test_Sensitivity Test_F1 New_Accuracy
1 Random Forest        0.9569           0.9444  0.9379       0.9900
2      AdaBoost        0.9569           0.9583  0.9388       0.9857
3       XGBoost        0.9665           0.9861  0.9530       0.9757
  New_Sensitivity New_F1
1          0.9909 0.9842
2          0.9955 0.9777
3          0.9909 0.9625</code></pre>
</div>
</div>
<p><strong>Interpretación:</strong></p>
<p>La tabla revela patrones contrastantes entre test y generalización:</p>
<ul>
<li><strong>Test</strong>: XGBoost lidera en Sensitivity (0.9861) y F1 (0.953)</li>
<li><strong>Nuevos</strong>: Random Forest lidera en F1 (0.9842), AdaBoost en Sensitivity (0.9955)</li>
<li><strong>Degradación</strong>: XGBoost muestra mayor caída (-0.030 en F1), RF la menor (-0.010)</li>
</ul>
<p>Esto evidencia trade-off fundamental: <strong>XGBoost optimiza test, Random Forest generaliza mejor</strong>.</p>
</section>
<section id="análisis-por-algoritmo" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="análisis-por-algoritmo"><span class="header-section-number">12.2</span> Análisis por Algoritmo</h2>
<p><strong>Random Forest:</strong></p>
<ul>
<li>Mejor generalización (degradación F1: -0.010)</li>
<li>Sensitivity consistente ~94-99% en ambos conjuntos</li>
<li>Frontera no lineal con alta interpretabilidad</li>
<li><strong>Recomendado para producción</strong></li>
</ul>
<p><strong>AdaBoost:</strong></p>
<ul>
<li>Máxima sensitivity en nuevos (99.55%)</li>
<li>Degradación moderada (F1: -0.016)</li>
<li>Sensible a casos difíciles del desbalanceo</li>
<li><strong>Ideal para screening donde FN son críticos</strong></li>
</ul>
<p><strong>XGBoost:</strong></p>
<ul>
<li>Mejor rendimiento en test (F1: 0.953)</li>
<li>Mayor degradación en nuevos (F1: -0.030)</li>
<li>Threshold optimizado muy efectivo en validación</li>
<li><strong>Excelente para datasets controlados</strong></li>
</ul>
</section>
<section id="variables-clave-identificadas" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="variables-clave-identificadas"><span class="header-section-number">12.3</span> Variables Clave Identificadas</h2>
<p>Consistencia transversal:</p>
<ol type="1">
<li><strong>Bare.nuclei</strong> - Máxima importancia (RF/AdaBoost)</li>
<li><strong>Cell.size/Cell.shape</strong> - Dominantes (XGBoost)</li>
<li><strong>Cl.thickness</strong> - Alta relevancia consistente</li>
<li><strong>Bl.cromatin</strong> - Fuerte capacidad discriminativa</li>
<li><strong>Mitoses</strong> - Menor contribución</li>
</ol>
</section>
<section id="recomendaciones-por-contexto-clínico" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="recomendaciones-por-contexto-clínico"><span class="header-section-number">12.4</span> Recomendaciones por Contexto Clínico</h2>
<p><strong>Para despliegue en producción (datos no vistos):</strong></p>
<ul>
<li><strong>Random Forest</strong> - F1=0.984, mejor estabilidad</li>
<li>Degradación mínima garantiza predicciones confiables</li>
</ul>
<p><strong>Para screening masivo (minimizar FN):</strong></p>
<ul>
<li><strong>AdaBoost</strong> - Sensitivity=99.5% en nuevos</li>
<li>Acepta más falsos positivos (biopsias preventivas)</li>
</ul>
<p><strong>Para validación controlada:</strong></p>
<ul>
<li><strong>XGBoost</strong> - F1=0.953 con threshold optimizado</li>
<li>Requiere monitoreo continuo en producción</li>
</ul>
<p><strong>Estrategia ensemble:</strong></p>
<ul>
<li>Combinar RF + AdaBoost vía voting</li>
<li>Maximiza robustez y sensitivity simultáneamente</li>
</ul>
</section>
<section id="conclusión-general" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="conclusión-general"><span class="header-section-number">12.5</span> Conclusión General</h2>
<p><strong>No existe un “modelo óptimo único”.</strong> La elección depende del contexto operacional:</p>
<ul>
<li><strong>Producción real</strong>: Random Forest (mejor generalización)</li>
<li><strong>Screening poblacional</strong>: AdaBoost (máxima detección)</li>
<li><strong>Ambiente controlado</strong>: XGBoost (máximo rendimiento test)</li>
</ul>
<p>Los tres modelos son clínicamente viables (accuracy &gt;95%). La diferencia crítica está en el <strong>trade-off entre rendimiento máximo y estabilidad en datos no vistos</strong>.</p>
<p><strong>Recomendación final</strong>: Random Forest ofrece el mejor balance para aplicaciones clínicas reales donde la generalización a pacientes nuevos es el criterio decisivo. Para contextos donde no detectar un solo caso maligno es inaceptable, AdaBoost con sensitivity=99.5% es la opción correcta.</p>
</section>
</section>
<section id="referencias" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Referencias</h1>
<p>Wolberg, W.H., &amp; Mangasarian, O.L. (1990). <em>Multisurface method of pattern separation for medical diagnosis applied to breast cytology</em>. PNAS, 87(23), 9193-9196.</p>
<p>Breiman, L. (2001). <em>Random Forests</em>. Machine Learning, 45(1), 5-32.</p>
<p>Freund, Y., &amp; Schapire, R.E. (1997). <em>A Decision-Theoretic Generalization of On-Line Learning and an Application to Boosting</em>. Journal of Computer and System Sciences, 55(1), 119-139.</p>
<p>Chen, T., &amp; Guestrin, C. (2016). <em>XGBoost: A Scalable Tree Boosting System</em>. Proceedings of the 22nd ACM SIGKDD International Conference on Knowledge Discovery and Data Mining.</p>
<p>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em> (2nd ed.). Springer.</p>
<p>Kuhn, M. (2008). <em>Building Predictive Models in R Using the caret Package</em>. Journal of Statistical Software, 28(5), 1-26.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>